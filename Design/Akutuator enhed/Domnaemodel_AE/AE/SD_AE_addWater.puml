@startuml SD_AE_addWater

Participant Aktuatorenhed as ae
participant _saltPumpe as tp
participant _demiPumpe as sp
actor OS as os





title int Aktuatorenhed::addWater(double ml, double currentPsu)


        ae -> ae : addWater(double ml, double currentPsu)
        activate ae
        ae -> ae : double mlSaltvand = (ml/(10*_saltKonc))*currentPsu
            
            ae -> tp : setDutyCycle(90)
            activate tp
            tp -> tp : _dutyCycle = 90
            ae <-- tp
            deactivate tp
            ae -> sp : setDutyCycle(90)
            activate sp
            sp -> sp : _dutyCycle = 90
            ae <-- sp
            deactivate sp

            ae -> tp : setState(true);
            activate tp
            tp -> os : setPWM(GPIO, _dutyCycle)
            tp <-- os
            ae <-- tp
            deactivate tp
            ae -> sp : setState(true);
            activate sp
            sp -> os : setPWM(GPIO, _dutyCycle)
            sp <-- os
            ae <-- sp
            deactivate sp

        ae -> ae : sleep(mlSaltvand*0.04)

        ae -> tp : setState(false);
            activate tp
            tp -> os : setPWM(GPIO, 0)
            tp <-- os
            ae <-- tp
            deactivate tp
                 
        ae -> ae : sleep((ml-2*mlSaltvand)*0.04)
        ae -> sp : setState(false);
            activate sp
            sp -> os : setPWM(GPIO, 0)
            sp <-- os
            ae <-- sp
            deactivate sp
            ae <-- ae : return 0
     deactivate ae
            
            
            

@enduml